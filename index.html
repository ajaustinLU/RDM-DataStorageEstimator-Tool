<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lakehead University Research Storage Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --lu-blue: rgb(0,65,125);
            --lu-yellow: rgb(255,195,15);
            --lu-red: rgb(200,30,35);
            --light-bg: #f8f9fa;
            --text-dark: #2c3e50;
            --text-light: #6c757d;
            --border-color: #e2e8f0;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background-color: #f0f2f5; }
        .storage-calculator { max-width: 1400px; margin: 0 auto; padding: 20px; background: linear-gradient(135deg, var(--lu-blue) 0%, rgb(0,85,145) 100%); min-height: 100vh; }
        .header { text-align: center; color: white; margin-bottom: 20px; }
        .header h1 { font-size: 2.5em; font-weight: 700; margin-bottom: 10px; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
        .header .sub-header { font-size: 1.5em; font-weight: 500; opacity: 0.9; }
        .header p { font-size: 1.1em; opacity: 0.9; max-width: 700px; margin: 10px auto 0; }
        .main-container { display: grid; grid-template-columns: 1fr 420px; gap: 30px; align-items: start; }
        @media (max-width: 1024px) { .main-container { grid-template-columns: 1fr; } }
        .calculator-panel, .results-panel { background: white; border-radius: 20px; padding: 30px; box-shadow: 0 20px 60px rgba(0,0,0,0.1); }
        .results-panel { position: sticky; top: 20px; }
        .section-header { display: flex; align-items: center; gap: 12px; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px solid var(--border-color); }
        .section-header h2 { font-size: 1.5em; color: var(--text-dark); font-weight: 600; }
        .file-inputs { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; }
        .input-group { background: white; border-radius: 12px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); transition: all 0.3s ease; }
        .input-group:hover { box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .input-label { font-weight: 600; color: var(--text-dark); margin-bottom: 4px; font-size: 0.95em; display:flex; align-items:center; gap: 5px; }
        .input-description { font-size: 0.8em; color: var(--text-light); margin-bottom: 8px; }
        .input-field input { width: 100%; padding: 12px 15px; border: 2px solid var(--border-color); border-radius: 8px; font-size: 16px; transition: all 0.3s ease; background: #fff; }
        .input-field input:focus { outline: none; border-color: var(--lu-yellow); box-shadow: 0 0 0 3px rgba(255, 195, 15, 0.1); }
        .planning-section { background: linear-gradient(135deg, rgba(0,65,125,0.05) 0%, rgba(0,85,145,0.02) 100%); border: 1px solid var(--border-color); border-radius: 16px; padding: 25px; margin: 25px 0; }
        .planning-section h3 { color: var(--text-dark); margin-bottom: 10px; font-size: 1.3em; }
        .planning-section p { color: var(--text-dark); margin-bottom: 20px; opacity: 0.8; }
        .planning-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .generic-slider-control { margin-bottom: 5px; }
        .generic-slider-control label { font-size: 0.9em; color: var(--text-dark); margin-bottom: 8px; display: block; font-weight:600; }
        .generic-slider-display { text-align: center; font-size: 0.9em; color: var(--lu-blue); font-weight: 600; margin-top: 5px; }
        .policy-note { font-size: 0.8em; color: var(--text-light); text-align: center; margin-top: 8px; }
        .results-header { text-align: center; margin-bottom: 20px; }
        .results-header h2 { color: var(--text-dark); font-size: 1.75em; font-weight: 700; }
        .primary-result { background: linear-gradient(135deg, var(--lu-blue) 0%, rgb(0,85,145) 100%); color: white; text-align: center; padding: 25px 20px; border-radius: 16px; margin-bottom: 15px; }
        .primary-result .label { font-size: 1em; opacity: 0.9; margin-bottom: 8px; font-weight: 500; }
        .primary-result .value { font-size: 2.8em; font-weight: 700; line-height: 1.1; }
        .secondary-results { display: grid; gap: 10px; margin-bottom: 20px; }
        .result-item { background: var(--light-bg); padding: 15px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--border-color); }
        .result-item .label { color: var(--text-light); font-size: 0.9em; }
        .result-item .value { font-weight: 600; color: var(--text-dark); font-size: 1.05em; }
        .warning-message { margin-top: 20px; padding: 15px; border-radius: 12px; font-weight: 600; text-align: center; }
        .warning-high { background: rgba(255,195,15,0.1); color: var(--lu-blue); border: 2px solid rgba(255,195,15,0.5); }
        .warning-critical { background: rgba(200,30,35,0.1); color: var(--lu-red); border: 2px solid rgba(200,30,35,0.3); }
        .action-buttons { display: grid; grid-template-columns: 1fr; gap: 12px; margin-top: 25px; }
        .action-btn { background: var(--lu-yellow); color: var(--lu-blue); border: 2px solid var(--lu-yellow); padding: 12px; border-radius: 12px; cursor: pointer; font-weight: 700; font-size: 1em; text-align:center; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .action-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 20px rgba(255,195,15,0.4); }
        
        /* Accordion Styles */
        .accordion-set { display: grid; gap: 10px; }
        .accordion-header { background-color: var(--light-bg); color: var(--text-dark); cursor: pointer; padding: 18px; width: 100%; border: none; text-align: left; outline: none; font-size: 1.2em; font-weight: 600; transition: all 0.3s ease; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid var(--lu-blue); }
        .accordion-header:hover, .accordion-header.active { background-color: #e2e8f0; }
        .accordion-header.glow { animation: glow 1s ease-out; }
        @keyframes glow { 0% { box-shadow: 0 0 0px var(--lu-yellow); } 50% { box-shadow: 0 0 10px 3px var(--lu-yellow); } 100% { box-shadow: 0 0 0px var(--lu-yellow); } }
        .accordion-header .icon { transition: transform 0.3s ease; }
        .accordion-header.active .icon { transform: rotate(180deg); }
        .accordion-panel { padding: 0 18px; background-color: white; max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out; border-radius: 0 0 12px 12px; border: 1px solid var(--border-color); border-top: none; }
        .accordion-panel-content { padding: 20px 0; }

        /* Tooltip Styles */
        .tooltip-trigger { cursor: help; border-bottom: 1px dotted var(--text-light); position: relative; }
        .tooltip-trigger .tooltip-text { visibility: hidden; width: 220px; background-color: var(--text-dark); color: #fff; text-align: center; border-radius: 6px; padding: 10px; position: absolute; z-index: 10; bottom: 130%; left: 50%; margin-left: -110px; opacity: 0; transition: opacity 0.3s; font-size: 0.85em; font-weight: 400; box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
        .tooltip-trigger:hover .tooltip-text { visibility: visible; opacity: 1; }

        /* Chart Styles */
        .results-visuals { display: flex; justify-content: center; margin-top: 20px; }
        #chart-container { max-width: 250px; margin: 0 auto; }
        
        /* Enhanced Button Selection */
        .format-options { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 8px; margin-top: 10px; }
        .format-btn { background: var(--light-bg); border: 2px solid var(--border-color); border-radius: 8px; padding: 8px 10px; text-align: center; cursor: pointer; font-size: 0.85em; font-weight: 500; transition: all 0.2s ease; }
        .format-btn:hover { background: #e9ecef; border-color: #adb5bd; }
        .format-btn.active { background: var(--lu-blue); color: white; border-color: var(--lu-blue); font-weight: 700; box-shadow: 0 4px 10px rgba(0, 65, 125, 0.3); transform: translateY(-2px); }

        .planning-btn { background: white; border: 2px solid var(--border-color); border-radius: 12px; padding: 15px 10px; text-align: center; cursor: pointer; transition: all 0.3s ease; font-weight: 600; font-size: 0.9em; }
        .planning-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .planning-btn.active { background: var(--lu-blue); color: white; border-color: var(--lu-blue); transform: translateY(-2px); box-shadow: 0 6px 25px rgba(0, 65, 125, 0.3); }
        .planning-btn .main-text, .multiplier-btn .main-text { display: block; font-size: 1em; }
        .planning-btn .sub-text, .multiplier-btn .sub-text { display: block; font-size: 0.75em; opacity: 0.7; margin-top: 4px; }

        /* Custom Input Style */
        .custom-input-container { display: flex; gap: 15px; align-items: flex-end; margin-top: 10px; }
        .custom-input-container > div { flex: 1; }
        .custom-input-container label { font-size: 0.85em; color: var(--text-light); margin-bottom: 4px; display: block; }

    </style>
</head>
<body>
    <div class="storage-calculator">
        <div class="header">
            <h1>üóÑÔ∏è Research Storage Calculator</h1>
            <div class="sub-header">for Lakehead University</div>
            <p>An interactive tool for precision storage planning, cost estimation, and direct consultation for your research project.</p>
        </div>

        <div class="main-container">
            <div class="calculator-panel">

                <div class="planning-section">
                    <h3>‚úÖ Project Setup</h3>
                    <p>Define your project's lifecycle and collaborative needs.</p>
                    <div class="planning-grid">
                        <div class="generic-slider-control">
                            <label>Active Research Phase</label>
                            <input type="range" id="active-duration" min="1" max="10" step="1" value="3">
                            <div class="generic-slider-display" id="active-duration-display">3 Years</div>
                        </div>
                        <div class="generic-slider-control">
                            <label>Long-Term Archival</label>
                            <input type="range" id="archival-duration" min="7" max="20" step="1" value="7">
                            <div class="generic-slider-display" id="archival-duration-display">7 Years</div>
                            <p class="policy-note">Minimum 7 years as per LUFA agreement.</p>
                        </div>
                    </div>
                </div>

                <div class="section-header">
                    <span class="icon">üßÆ</span>
                    <h2>File Requirements</h2>
                </div>

                <div class="accordion-set">
                    <!-- Categories will be dynamically generated by JS -->
                </div>

                <div class="planning-section">
                    <h3>üéØ Storage Strategy</h3>
                    <p>Select a multiplier to account for backups and versioning. This multiplies your 'Base Data Size' to calculate the 'Total Active Storage', ensuring space for redundant copies and project growth.</p>
                    <div class="planning-grid" id="multiplier-selector" style="grid-template-columns: repeat(4, 1fr);">
                        <div class="planning-btn multiplier-btn" data-multiplier="1"><span class="main-text">Raw</span><span class="sub-text">1 copy</span></div>
                        <div class="planning-btn multiplier-btn active" data-multiplier="3"><span class="main-text">Standard</span><span class="sub-text">3-2-1</span></div>
                        <div class="planning-btn multiplier-btn" data-multiplier="4"><span class="main-text">Versioning</span><span class="sub-text">+ Versions</span></div>
                        <div class="planning-btn multiplier-btn" data-multiplier="7"><span class="main-text">Enterprise</span><span class="sub-text">Redundant</span></div>
                    </div>
                </div>
            </div>

            <div class="results-panel">
                <div class="results-header"><h2>Storage Requirements</h2></div>
                <div class="primary-result">
                    <div class="label">Total Active Storage</div>
                    <div class="value" id="total-storage">0 GB</div>
                </div>
                <div class="secondary-results">
                    <div class="result-item"><span class="label">Base Data Size</span><span class="value" id="base-storage">0 GB</span></div>
                    <div class="result-item"><span class="label">Strategy Multiplier</span><span class="value" id="storage-strategy">3x (Standard)</span></div>
                    <div class="result-item"><span class="label">Long-Term Archival</span><span class="value" id="archival-storage">0 GB</span></div>
                </div>
                
                <div class="results-visuals">
                    <div id="chart-container">
                        <canvas id="storage-chart"></canvas>
                    </div>
                </div>

                <div id="warning-message"></div>
                
                <div class="action-buttons">
                    <button class="action-btn" id="consult-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.73 18a2.64 2.64 0 0 0-3.76 0L14 22H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v12.27Z"/><path d="M16 8h-6"/><path d="M16 12h-6"/></svg>
                        Request Consultation
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
    // --- DATA & CONFIG ---
    const fileCategories = {
        "üìÑ General Documents & Data": {
            color: 'rgb(0, 102, 179)',
            files: {
                'pdfs': { label: 'PDF Documents', type: 'format', options: {'Text Heavy': 3, 'With Images': 12, 'Scanned': 120} },
                'word-docs': { label: 'Word Documents', size: 2, unit: 'documents' },
                'transcripts': { label: 'Transcripts', size: 0.1, unit: 'hours of audio' },
                'excel': { label: 'Spreadsheets (Excel/CSV)', type: 'format', options: {'1K Basic': 0.3, '1K Mixed': 2, '10K Basic': 10, '10K Complex': 50} },
                'survey': { label: 'Survey Data', size: 2, unit: 'exports (1k resp.)' }
            }
        },
        "üé¨ Audio & Video Media": {
            color: 'rgb(200,30,35)',
            files: {
                'audio_standard': { label: 'Audio Recordings', type: 'format-minutes', options: {'WAV 16-bit': 635, 'MP3 320k': 144, 'WAV 24-bit': 2073} },
                'video': { label: 'Video Recordings', type: 'format-minutes', options: {'1080p Med': 3600, '1080p High': 7200, '4K Med': 14400, '4K High': 28800} }
            }
        },
        "üñºÔ∏è Specialized Imaging": {
            color: 'rgb(255, 195, 15)',
            files: {
                'photos': { label: 'Research Photos', type: 'format', options: {'JPEG High': 12, 'RAW': 35, 'Microscopy': 300} },
                'img_confocal': { label: 'Confocal Microscopy', size: 5000, unit: 'stacks', tooltip: 'Layered 3D images from a confocal microscope, often large.' },
                'img_pathology': { label: 'Digital Pathology', size: 2000, unit: 'scanned slides', tooltip: 'High-resolution scans of entire microscope slides.' }
            }
        },
        "üî¨ Discipline-Specific & Software Files": {
            color: 'rgb(0, 133, 63)',
            files: {
                'stats-files': { label: 'Statistical Software', size: 15, unit: 'datasets (1k cases)' },
                'nvivo': { label: 'NVivo Project Files', size: 1000, unit: 'projects', tooltip: 'Qualitative data analysis projects containing text, audio, and video.' },
                'matlab': { label: 'MATLAB Workspace', size: 500, unit: 'workspaces' },
                'gis-data': { label: 'GIS/Mapping Data', size: 100, unit: 'datasets' },
                'gis_lidar': { label: 'LiDAR Geospatial Data', size: 20000, unit: 'scans', tooltip: '3D point cloud data from laser scanning, common in geography.' }
            }
        },
        "üí® High-Performance & Genomics Data": {
            color: 'rgb(106, 76, 156)',
            files: {
                'hpc_raw': { label: 'Raw Simulation Output', size: 50000, unit: 'runs' },
                'geno_fastq': { label: 'Unaligned Reads (FASTQ)', size: 30000, unit: 'samples', tooltip: 'Raw DNA/RNA sequence data from a sequencer.' },
                'geno_bam': { label: 'Aligned Data (BAM/SAM)', size: 40000, unit: 'samples', tooltip: 'Sequence data after alignment to a reference genome.' }
            }
        },
        "‚öôÔ∏è Custom Data Type": {
            color: 'rgb(108, 117, 125)',
            files: {
                'custom': { label: 'Custom Data', type: 'custom' }
            }
        }
    };

    let chart;

    // --- STATE ---
    let state = {
        fileSizes: {},
        inputs: {},
        multiplier: 3,
        activeDuration: 3,
        archivalDuration: 7
    };

    // --- DOM GENERATION ---
    function generateAccordions() {
        const container = document.querySelector('.accordion-set');
        let html = '';
        for (const [category, config] of Object.entries(fileCategories)) {
            html += `
                <div>
                    <button class="accordion-header" style="border-left-color: ${config.color};">
                        ${category} <span class="icon">‚ñº</span>
                    </button>
                    <div class="accordion-panel">
                        <div class="accordion-panel-content">
                            <div class="file-inputs">
                                ${generateInputs(config.files)}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        container.innerHTML = html;
    }

    function generateInputs(files) {
        let inputsHtml = '';
        for (const [id, file] of Object.entries(files)) {
            state.inputs[id] = 0;
            let tooltipHtml = file.tooltip ? `<span class="tooltip-trigger">(?)<span class="tooltip-text">${file.tooltip}</span></span>` : '';
            inputsHtml += `<div class="input-group" data-file-id="${id}">`;
            inputsHtml += `<div class="input-label">${file.label} ${tooltipHtml}</div>`;
            
            if (file.type === 'format' || file.type === 'format-minutes') {
                const firstOption = Object.keys(file.options)[0];
                state.fileSizes[id] = file.options[firstOption];
                inputsHtml += `<div class="format-options" data-target-id="${id}">`;
                for (const [name, size] of Object.entries(file.options)) {
                    inputsHtml += `<button class="format-btn ${name === firstOption ? 'active' : ''}" data-size="${size}">${name}</button>`;
                }
                inputsHtml += `</div>`;
            } else if (file.type !== 'custom') {
                 state.fileSizes[id] = file.size;
            }

            if (file.type === 'format-minutes') {
                inputsHtml += `
                    <div class="custom-input-container">
                        <div>
                            <label for="${id}">Number of Recordings</label>
                            <div class="input-field"><input type="number" id="${id}" min="0" value="0" placeholder="e.g., 10"></div>
                        </div>
                        <div>
                            <label for="${id}_minutes">Avg. Duration (minutes)</label>
                            <div class="input-field"><input type="number" id="${id}_minutes" min="0" value="60" placeholder="e.g., 60"></div>
                        </div>
                    </div>
                `;
                state.inputs[id + '_minutes'] = 60;
            } else if (file.type === 'custom') {
                 inputsHtml += `<div class="input-description">Enter number of files and average size per file.</div>`;
                 inputsHtml += `
                    <div class="custom-input-container">
                        <div>
                            <label for="custom_count">Number of Files</label>
                            <div class="input-field"><input type="number" id="custom_count" min="0" value="0" placeholder="e.g., 50"></div>
                        </div>
                        <div>
                            <label for="custom_size">Avg. Size (MB)</label>
                            <div class="input-field"><input type="number" id="custom_size" min="0" value="100" placeholder="e.g., 250"></div>
                        </div>
                    </div>
                 `;
                 state.inputs['custom_count'] = 0;
                 state.inputs['custom_size'] = 100;
            } else {
                 inputsHtml += `<div class="input-field"><input type="number" id="${id}" min="0" value="0" placeholder="Number of ${file.unit || 'files'}"></div>`;
            }
            inputsHtml += `</div>`;
        }
        return inputsHtml;
    }

    // --- CALCULATION & DISPLAY ---
    function calculateAndRender() {
        let totalMB = 0;
        let contributions = {};

        for (const category in fileCategories) {
            contributions[category] = 0;
        }

        for (const [id, count] of Object.entries(state.inputs)) {
            if (count > 0 && state.fileSizes[id]) {
                let sizeMB = count * state.fileSizes[id];
                const fileDef = findFileDef(id);

                if (fileDef && fileDef.type === 'format-minutes') {
                    const minutes = state.inputs[id + '_minutes'] || 0;
                    sizeMB *= (minutes / 60);
                }
                
                totalMB += sizeMB;
                const category = findCategoryForFile(id);
                if (category) {
                    contributions[category] += sizeMB;
                }
            }
        }
        
        // Custom data
        const customTotal = state.inputs.custom_count * state.inputs.custom_size;
        if (customTotal > 0) {
            totalMB += customTotal;
            contributions["‚öôÔ∏è Custom Data Type"] += customTotal;
        }

        const baseGB = totalMB / 1024;
        const totalGB = baseGB * state.multiplier;
        const archivalGB = baseGB * 2; // Simpler 2x multiplier for archival

        // Update Display
        document.getElementById('base-storage').textContent = `${baseGB.toFixed(1)} GB`;
        document.getElementById('total-storage').textContent = totalGB < 1024 ? `${totalGB.toFixed(1)} GB` : `${(totalGB/1024).toFixed(2)} TB`;
        document.getElementById('archival-storage').textContent = `${archivalGB.toFixed(1)} GB`;
        
        const activeBtn = document.querySelector('#multiplier-selector .multiplier-btn.active');
        const strategyName = activeBtn ? activeBtn.querySelector('.main-text').textContent : 'N/A';
        document.getElementById('storage-strategy').textContent = `${state.multiplier}x (${strategyName})`;

        updateChart(contributions);
        updateWarnings(totalGB);
    }
    
    function updateChart(contributions) {
        const ctx = document.getElementById('storage-chart').getContext('2d');
        const labels = Object.keys(contributions).filter(k => contributions[k] > 0);
        const data = labels.map(k => (contributions[k] / 1024).toFixed(2));
        const colors = labels.map(k => fileCategories[k].color);

        if (chart) {
            chart.data.labels = labels;
            chart.data.datasets[0].data = data;
            chart.data.datasets[0].backgroundColor = colors;
            chart.update();
        } else {
            chart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderColor: '#fff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { font: { size: 10 } } },
                        tooltip: { callbacks: { label: (context) => `${context.label}: ${context.raw} GB` } }
                    }
                }
            });
        }
    }
    
    function updateWarnings(totalGB) {
        const warningDiv = document.getElementById('warning-message');
        const totalTB = totalGB / 1024;
        if (totalTB > 5) {
            warningDiv.innerHTML = `<div class="warning-message warning-critical">üö® MASSIVE SCALE: ${totalTB.toFixed(1)} TB requires enterprise infrastructure and a formal consultation.</div>`;
        } else if (totalTB > 1) {
            warningDiv.innerHTML = `<div class="warning-message warning-critical">‚ö†Ô∏è ENTERPRISE TIER: ${totalTB.toFixed(1)} TB requires professional storage solutions.</div>`;
        } else if (totalGB > 200) {
            warningDiv.innerHTML = `<div class="warning-message warning-high">üí° SIGNIFICANT STORAGE: ${totalGB.toFixed(0)} GB needs dedicated systems. Ensure your DMP is robust.</div>`;
        } else {
            warningDiv.innerHTML = '';
        }
    }
    
    // --- EVENT HANDLERS ---
    function setupEventListeners() {
        document.querySelector('.accordion-set').addEventListener('click', (e) => {
            // Accordion toggle
            if (e.target.classList.contains('accordion-header')) {
                e.target.classList.toggle('active');
                const panel = e.target.nextElementSibling;
                panel.style.maxHeight = panel.style.maxHeight ? null : panel.scrollHeight + 'px';
            }
            // Format buttons
            if (e.target.classList.contains('format-btn')) {
                const targetId = e.target.parentElement.dataset.targetId;
                e.target.parentElement.querySelectorAll('.format-btn').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
                state.fileSizes[targetId] = parseFloat(e.target.dataset.size);
                calculateAndRender();
            }
        });

        document.querySelector('.accordion-set').addEventListener('input', (e) => {
            const id = e.target.id;
            state.inputs[id] = parseFloat(e.target.value) || 0;
            const fileId = e.target.closest('.input-group').dataset.fileId;
            if (fileId) {
                const header = e.target.closest('.accordion-panel').previousElementSibling;
                header.classList.add('glow');
                setTimeout(() => header.classList.remove('glow'), 1000);
            }
            calculateAndRender();
        });

        document.getElementById('multiplier-selector').addEventListener('click', (e) => {
            const btn = e.target.closest('.multiplier-btn');
            if (btn) {
                document.querySelectorAll('.multiplier-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                state.multiplier = parseFloat(btn.dataset.multiplier);
                calculateAndRender();
            }
        });
        
        ['active-duration', 'archival-duration'].forEach(id => {
            document.getElementById(id).addEventListener('input', e => {
                const value = parseInt(e.target.value);
                if(id === 'active-duration') state.activeDuration = value;
                else state.archivalDuration = value;
                document.getElementById(`${id}-display`).textContent = `${value} Years`;
                calculateAndRender();
            });
        });
        
        document.getElementById('consult-btn').addEventListener('click', generateConsultationEmail);
    }
    
    function generateConsultationEmail() {
        const subject = "Research Data Storage Consultation Request";
        let body = "Hello Research Data Management Team,\n\nI am planning a new research project and have used the storage calculator to estimate my needs. Please see the summary below.\n\n";
        body += "--- PROJECT SUMMARY ---\n";
        body += `Active Phase: ${state.activeDuration} years\n`;
        body += `Archival Phase: ${state.archivalDuration} years\n\n`;
        body += "--- STORAGE ESTIMATE ---\n";
        body += `Base Data Size: ${document.getElementById('base-storage').textContent}\n`;
        const activeBtn = document.querySelector('#multiplier-selector .multiplier-btn.active');
        const strategyName = activeBtn ? activeBtn.querySelector('.main-text').textContent : 'N/A';
        body += `Storage Strategy: ${state.multiplier}x (${strategyName})\n`;
        body += `Total Active Storage: ${document.getElementById('total-storage').textContent}\n`;
        body += `Long-Term Archival Storage: ${document.getElementById('archival-storage').textContent}\n\n`;
        body += "--- FILE BREAKDOWN ---\n";
        for (const [id, count] of Object.entries(state.inputs)) {
            if (count > 0 && id !== 'custom_size' && !id.endsWith('_minutes')) {
                const label = findFileDef(id)?.label || id;
                body += `- ${label}: ${count} units\n`;
            }
        }
        body += "\nI would like to schedule a consultation to discuss appropriate storage solutions.\n\n";
        body += "Thank you,";
        
        window.location.href = `mailto:rdm.research@lakeheadu.ca?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    }

    // --- UTILITY ---
    function findFileDef(id) {
        for (const category of Object.values(fileCategories)) {
            if (category.files[id]) return category.files[id];
        }
        return null;
    }
    function findCategoryForFile(id) {
        for (const [name, category] of Object.entries(fileCategories)) {
            if (category.files[id]) return name;
        }
        return null;
    }

    // --- INITIALIZATION ---
    document.addEventListener('DOMContentLoaded', () => {
        generateAccordions();
        setupEventListeners();
        calculateAndRender();
    });
    </script>
</body>
</html>
